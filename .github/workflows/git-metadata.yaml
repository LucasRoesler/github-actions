name: Reusable Workflow for Git Operations

on:
  push:

jobs:
  run-git-operations:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: install git-describe
        run: npm install @contiamo/git-describe

      - name: Run Git Operations Script
        uses: actions/github-script@v7
        with:
          script: |
            const { getSemanticVersion } = require('@contiamo/git-describe');

            let sha = '';
            try {
              // truncate the SHA to 7 characters
              sha = context.sha.slice(0, 7);

              core.setOutput('shortSHA', sha);
            } catch (error) {
              const msg = error instanceof Error ? error.message : String(error);
              core.setFailed(msg);
            }

            try {
              const regex = /\+/i;
              const semver = getSemanticVersion();
              core.setOutput('semver', semver.replace(regex, '.'));
            } catch (error) {
              const msg = error instanceof Error ? error.message : String(error);
              core.warning(msg);
              core.setOutput('semver', sha);
            }
      - name: Echo Outputs
        run: |
          echo "Short SHA: ${{ steps.run-git-operations.outputs.shortSHA }}"
          echo "Semantic Version: ${{ steps.run-git-operations.outputs.semver }}"
